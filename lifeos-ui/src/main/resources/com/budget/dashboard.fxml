<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.chart.*?>
<?import javafx.scene.shape.Circle?>

<StackPane fx:id="rootPane" xmlns="http://javafx.com/javafx/17"
           xmlns:fx="http://javafx.com/fxml/1"
           fx:controller="com.budget.controller.DashboardController"
           stylesheets="@style.css">

    <BorderPane fx:id="mainLayout">

        <left>
            <VBox styleClass="sidebar" spacing="10" prefWidth="220">
                <padding><Insets top="20" right="10" bottom="20" left="10"/></padding>

                <HBox alignment="CENTER_LEFT" spacing="10" style="-fx-padding: 0 0 20 10;">
                    <Circle radius="15" fill="#4fa3c7"/>
                    <VBox>
                        <Label text="Life OS 2.0" style="-fx-text-fill: white; -fx-font-weight: bold; -fx-font-size: 16px;"/>
                        <Label text="Enterprise Edition" style="-fx-text-fill: #8b92a1; -fx-font-size: 10px;"/>
                    </VBox>
                </HBox>

                <Separator style="-fx-opacity: 0.1; -fx-padding: 0 0 10 0;"/>

                <Button fx:id="btnKokpit" text="ðŸ   KOKPIT" onAction="#showKokpit" styleClass="sidebar-button" maxWidth="Infinity" alignment="CENTER_LEFT"/>
                <Button fx:id="btnFinanse" text="ðŸ’°  FINANSE" onAction="#showFinanse" styleClass="sidebar-button" maxWidth="Infinity" alignment="CENTER_LEFT"/>
                <Button fx:id="btnZadania" text="âœ…  ZADANIA" onAction="#showZadania" styleClass="sidebar-button" maxWidth="Infinity" alignment="CENTER_LEFT"/>
                <Button fx:id="btnCele" text="ðŸ†  CELE" onAction="#showCele" styleClass="sidebar-button" maxWidth="Infinity" alignment="CENTER_LEFT"/>
                <Button fx:id="btnRaporty" text="ðŸ“Š  RAPORTY" onAction="#showRaporty" styleClass="sidebar-button" maxWidth="Infinity" alignment="CENTER_LEFT"/>

                <Region VBox.vgrow="ALWAYS"/>

                <Button fx:id="btnUstawienia" text="âš™ï¸  SYSTEM" onAction="#showUstawienia" styleClass="sidebar-button" maxWidth="Infinity" alignment="CENTER_LEFT"/>
            </VBox>
        </left>

        <center>
            <StackPane style="-fx-background-color: #1f2229;">

                <VBox fx:id="viewKokpit" spacing="20" style="-fx-padding: 30;" visible="true">
                    <Label text="DzieÅ„ dobry! Oto TwÃ³j status." styleClass="header-title"/>

                    <HBox spacing="20">
                        <VBox styleClass="card-highlight" prefWidth="250" style="-fx-padding: 20;">
                            <Label text="SALDO CAÅKOWITE" style="-fx-text-fill: white; -fx-opacity: 0.7;"/>
                            <Label fx:id="dashBalanceLabel" text="0.00 PLN" style="-fx-text-fill: white; -fx-font-size: 24px; -fx-font-weight: bold;"/>
                        </VBox>
                        <VBox styleClass="card" prefWidth="250" style="-fx-padding: 20;">
                            <Label text="ZADANIA NA DZIÅš" styleClass="card-subtitle"/>
                            <Label fx:id="dashTasksLabel" text="0 do zrobienia" styleClass="card-value"/>
                        </VBox>
                        <VBox styleClass="card" prefWidth="250" style="-fx-padding: 20;">
                            <Label text="AKTYWNE CELE" styleClass="card-subtitle"/>
                            <Label fx:id="dashGoalsLabel" text="0 w toku" styleClass="card-value"/>
                        </VBox>
                    </HBox>

                    <Label text="Szybkie Akcje" styleClass="section-title"/>
                    <HBox spacing="15">
                        <Button text="+ Nowy Wydatek" onAction="#showFinanse" styleClass="button-outline"/>
                        <Button text="+ Nowe Zadanie" onAction="#showZadania" styleClass="button-outline"/>
                        <Button text="Ctrl+K (Komendy)" onAction="#toggleCommandPalette" styleClass="button-outline" style="-fx-opacity: 0.5;"/>
                    </HBox>
                </VBox>

                <BorderPane fx:id="viewFinanse" visible="false">
                    <center>
                        <VBox spacing="15" style="-fx-padding: 20;">
                            <HBox spacing="10" alignment="CENTER_LEFT" styleClass="card" style="-fx-padding: 15;">
                                <ComboBox fx:id="typeBox" promptText="Typ" prefWidth="100"/>
                                <TextField fx:id="categoryField" promptText="Kategoria"/>
                                <TextField fx:id="amountField" promptText="Kwota" prefWidth="80"/>
                                <TextField fx:id="descField" promptText="Opis" HBox.hgrow="ALWAYS"/>
                                <DatePicker fx:id="datePicker" promptText="Data" prefWidth="110" />
                                <Button text="DODAJ" onAction="#handleAddTransaction" styleClass="button-action" prefWidth="80"/>
                            </HBox>

                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <HBox spacing="5" alignment="CENTER_LEFT" HBox.hgrow="ALWAYS">
                                    <Button text="â—€" onAction="#prevMonth" styleClass="icon-button"/>
                                    <Label fx:id="monthLabel" text="STYCZEÅƒ 2026" styleClass="month-label"/>
                                    <Button text="â–¶" onAction="#nextMonth" styleClass="icon-button"/>
                                </HBox>
                                <TextField fx:id="searchField" promptText="ðŸ” Szukaj..." styleClass="search-field"/>
                            </HBox>

                            <TableView fx:id="transactionTable" VBox.vgrow="ALWAYS">
                                <columns>
                                    <TableColumn fx:id="colDate" text="DATA" prefWidth="100"/>
                                    <TableColumn fx:id="colCategory" text="KATEGORIA" prefWidth="150"/>
                                    <TableColumn fx:id="colDesc" text="OPIS" prefWidth="250"/>
                                    <TableColumn fx:id="colAmount" text="KWOTA" prefWidth="120"/>
                                    <TableColumn fx:id="colType" text="TYP" prefWidth="100"/>
                                </columns>
                                <columnResizePolicy><TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/></columnResizePolicy>
                            </TableView>
                        </VBox>
                    </center>
                    <right>
                        <VBox styleClass="card" alignment="TOP_CENTER" spacing="15" prefWidth="300">
                            <padding><Insets top="20" right="20" bottom="20" left="20"/></padding>
                            <BorderPane.margin><Insets top="20" right="20" bottom="20" left="0"/></BorderPane.margin>
                            <Label text="STRUKTURA" styleClass="card-title"/>
                            <PieChart fx:id="expenseChart" labelsVisible="false" legendSide="BOTTOM" VBox.vgrow="ALWAYS"/>
                            <Separator/>
                            <Label text="SALDO MIESIÄ„CA" styleClass="card-subtitle"/>
                            <Label fx:id="balanceLabel" text="0.00" styleClass="card-value-big"/>
                            <HBox alignment="CENTER" spacing="20">
                                <VBox alignment="CENTER"><Label text="WpÅ‚ywy" styleClass="card-subtitle"/><Label fx:id="incomeLabel" text="0.00" style="-fx-text-fill: #4c9a6a;"/></VBox>
                                <VBox alignment="CENTER"><Label text="Wydatki" styleClass="card-subtitle"/><Label fx:id="expenseLabel" text="0.00" style="-fx-text-fill: #8a3c3c;"/></VBox>
                            </HBox>
                        </VBox>
                    </right>
                </BorderPane>

                <VBox fx:id="viewZadania" visible="false" spacing="15" style="-fx-padding: 20;">
                    <HBox spacing="10" alignment="CENTER_LEFT" styleClass="card" style="-fx-padding: 15;">
                        <TextField fx:id="taskTitleField" promptText="Nowe zadanie..." HBox.hgrow="ALWAYS"/>
                        <ComboBox fx:id="priorityBox" promptText="Priorytet" prefWidth="110"/>
                        <DatePicker fx:id="taskDatePicker" promptText="Termin" prefWidth="120"/>
                        <Button text="DODAJ" onAction="#handleAddTask" styleClass="button-action"/>
                    </HBox>
                    <Label text="LISTA ZADAÅƒ" styleClass="section-title"/>
                    <ListView fx:id="taskListView" VBox.vgrow="ALWAYS" style="-fx-background-color: transparent;"/>
                </VBox>

                <VBox fx:id="viewCele" visible="false" spacing="15" style="-fx-padding: 20;">
                    <HBox spacing="10" alignment="CENTER_LEFT" styleClass="card" style="-fx-padding: 15;">
                        <TextField fx:id="goalNameField" promptText="Nazwa celu" HBox.hgrow="ALWAYS"/>
                        <TextField fx:id="goalTargetField" promptText="Cel (PLN)" prefWidth="100"/>
                        <TextField fx:id="goalCurrentField" promptText="Obecnie" prefWidth="100"/>
                        <DatePicker fx:id="goalDatePicker" promptText="Termin" prefWidth="120"/>
                        <Button text="DODAJ" onAction="#handleAddGoal" styleClass="button-action"/>
                    </HBox>
                    <Label text="CELE FINANSOWE" styleClass="section-title"/>
                    <ListView fx:id="goalListView" VBox.vgrow="ALWAYS" style="-fx-background-color: transparent;"/>
                </VBox>

                <VBox fx:id="viewRaporty" visible="false" spacing="20" style="-fx-padding: 20;">
                    <HBox spacing="20" VBox.vgrow="ALWAYS">
                        <VBox styleClass="card" HBox.hgrow="ALWAYS">
                            <Label text="TREND PRZYCHODÃ“W I WYDATKÃ“W" styleClass="card-title" style="-fx-padding: 10;"/>
                            <LineChart fx:id="trendChart"><xAxis><CategoryAxis label="MiesiÄ…c"/></xAxis><yAxis><NumberAxis/></yAxis></LineChart>
                        </VBox>
                        <VBox styleClass="card" HBox.hgrow="ALWAYS">
                            <Label text="ANALIZA KATEGORII" styleClass="card-title" style="-fx-padding: 10;"/>
                            <BarChart fx:id="categoryBarChart"><xAxis><CategoryAxis/></xAxis><yAxis><NumberAxis/></yAxis></BarChart>
                        </VBox>
                    </HBox>
                </VBox>

                <VBox fx:id="viewUstawienia" visible="false" spacing="20" style="-fx-padding: 40;" alignment="TOP_CENTER">
                    <VBox styleClass="card" maxWidth="600" style="-fx-padding: 20;">
                        <Label text="ZARZÄ„DZANIE DANYMI" styleClass="card-title"/>
                        <Label text="Pobierz swoje dane finansowe do formatu CSV." style="-fx-text-fill: gray;"/>
                        <Button text="EKSPORTUJ DO CSV" onAction="#handleExport" styleClass="button-action"/>
                    </VBox>
                    <VBox styleClass="card" maxWidth="600" style="-fx-padding: 20; -fx-border-color: #8a3c3c;">
                        <Label text="STREFA NIEBEZPIECZNA" styleClass="card-title" style="-fx-text-fill: #8a3c3c;"/>
                        <Button text="RESETUJ APLIKACJÄ˜" onAction="#handleClearDatabase" styleClass="button-action" style="-fx-background-color: #8a3c3c;"/>
                    </VBox>
                </VBox>

            </StackPane>
        </center>
    </BorderPane>

    <StackPane fx:id="commandPaletteOverlay" visible="false" style="-fx-background-color: rgba(0, 0, 0, 0.7);">
        <VBox maxWidth="600" maxHeight="400" spacing="10" styleClass="command-palette">
            <TextField fx:id="commandInput" promptText="Wpisz komendÄ™ (np. 'Nowe zadanie')..."
                       style="-fx-font-size: 16px; -fx-padding: 15; -fx-background-radius: 5 5 0 0;"/>
            <ListView fx:id="commandList" VBox.vgrow="ALWAYS" style="-fx-background-radius: 0 0 5 5; -fx-background-color: #262933;"/>
            <HBox spacing="10" style="-fx-padding: 5;">
                <Label text="â¬†â¬‡ Wybierz" style="-fx-text-fill: gray; -fx-font-size: 10px;"/>
                <Label text="ENTER Wykonaj" style="-fx-text-fill: gray; -fx-font-size: 10px;"/>
                <Label text="ESC Zamknij" style="-fx-text-fill: gray; -fx-font-size: 10px;"/>
            </HBox>
        </VBox>
    </StackPane>

</StackPane>