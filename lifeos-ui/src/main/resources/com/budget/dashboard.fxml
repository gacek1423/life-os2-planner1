<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.chart.*?>
<?import javafx.scene.shape.Circle?>

<StackPane fx:id="rootPane" xmlns="http://javafx.com/javafx/17"
           xmlns:fx="http://javafx.com/fxml/1"
           fx:controller="com.budget.controller.DashboardController"
           stylesheets="@style.css">

    <BorderPane fx:id="mainLayout">

        <left>
            <VBox styleClass="sidebar" spacing="10" prefWidth="220">
                <padding><Insets top="20" right="10" bottom="20" left="10"/></padding>

                <HBox alignment="CENTER_LEFT" spacing="10" style="-fx-padding: 0 0 20 10;">
                    <Circle radius="15" fill="#4fa3c7"/>
                    <VBox>
                        <Label text="Life OS 2.0" style="-fx-text-fill: white; -fx-font-weight: bold; -fx-font-size: 16px;"/>
                        <Label text="Enterprise Edition" style="-fx-text-fill: #8b92a1; -fx-font-size: 10px;"/>
                    </VBox>
                </HBox>

                <Separator style="-fx-opacity: 0.1; -fx-padding: 0 0 10 0;"/>

                <Button fx:id="btnKokpit" text="ðŸ   KOKPIT" onAction="#showKokpit" styleClass="sidebar-button" maxWidth="Infinity" alignment="CENTER_LEFT"/>
                <Button fx:id="btnFinanse" text="ðŸ’°  FINANSE" onAction="#showFinanse" styleClass="sidebar-button" maxWidth="Infinity" alignment="CENTER_LEFT"/>
                <Button fx:id="btnZadania" text="âœ…  ZADANIA" onAction="#showZadania" styleClass="sidebar-button" maxWidth="Infinity" alignment="CENTER_LEFT"/>
                <Button fx:id="btnCele" text="ðŸ†  CELE" onAction="#showCele" styleClass="sidebar-button" maxWidth="Infinity" alignment="CENTER_LEFT"/>
                <Button fx:id="btnRaporty" text="ðŸ“Š  RAPORTY" onAction="#showRaporty" styleClass="sidebar-button" maxWidth="Infinity" alignment="CENTER_LEFT"/>

                <Region VBox.vgrow="ALWAYS"/>

                <Button fx:id="btnUstawienia" text="âš™ï¸  SYSTEM" onAction="#showUstawienia" styleClass="sidebar-button" maxWidth="Infinity" alignment="CENTER_LEFT"/>
            </VBox>
        </left>

        <center>
            <StackPane style="-fx-background-color: #1f2229;">

                <VBox fx:id="viewKokpit" spacing="25" style="-fx-padding: 30;" visible="true">
                    <HBox alignment="CENTER_LEFT" spacing="20">
                        <VBox>
                            <Label text="Centrum Dowodzenia" styleClass="header-title"/>
                            <Label text="Oto TwÃ³j dzisiejszy przeglÄ…d sytuacji." style="-fx-text-fill: #8b92a1;"/>
                        </VBox>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Label fx:id="lblDate" text="Data..." style="-fx-text-fill: #8b92a1; -fx-font-size: 14px;"/>
                    </HBox>

                    <HBox spacing="20">
                        <VBox styleClass="card-highlight" HBox.hgrow="ALWAYS" style="-fx-padding: 20;">
                            <Label text="DOSTÄ˜PNE ÅšRODKI" style="-fx-text-fill: white; -fx-opacity: 0.8; -fx-font-size: 10px;"/>
                            <Label fx:id="dashBalanceLabel" text="0.00 PLN" style="-fx-text-fill: white; -fx-font-size: 26px; -fx-font-weight: bold;"/>
                        </VBox>
                        <VBox styleClass="card" HBox.hgrow="ALWAYS" style="-fx-padding: 20;">
                            <HBox alignment="CENTER_LEFT" spacing="10">
                                <Label text="PILNE ZADANIA" styleClass="card-subtitle"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Label text="ðŸ”¥" style="-fx-font-size: 16px;"/>
                            </HBox>
                            <Label fx:id="dashTasksLabel" text="0 zadaÅ„" styleClass="card-value"/>
                            <Label text="wymaga Twojej uwagi" style="-fx-text-fill: #8b92a1; -fx-font-size: 10px;"/>
                        </VBox>
                        <VBox styleClass="card" HBox.hgrow="ALWAYS" style="-fx-padding: 20;">
                            <HBox alignment="CENTER_LEFT" spacing="10">
                                <Label text="PÅYNNOÅšÄ† FINANSOWA" styleClass="card-subtitle"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Label text="ðŸ“ˆ" style="-fx-font-size: 16px;"/>
                            </HBox>
                            <Label fx:id="lblBudgetSummary" text="Analiza..." style="-fx-text-fill: #51cf66; -fx-font-size: 14px; -fx-font-weight: bold; padding: 10 0 0 0;"/>
                        </VBox>
                    </HBox>

                    <VBox spacing="10">
                        <Label text="MOJE PORTFELE (WIRTUALNE KONTA)" styleClass="card-subtitle"/>
                        <ScrollPane fitToHeight="true" vbarPolicy="NEVER" hbarPolicy="AS_NEEDED" style="-fx-background-color: transparent; -fx-background: transparent; -fx-padding: 0;">
                            <content>
                                <HBox fx:id="purseContainer" spacing="20" style="-fx-background-color: transparent;"/>
                            </content>
                        </ScrollPane>
                    </VBox>

                    <HBox spacing="20" VBox.vgrow="ALWAYS">
                        <VBox styleClass="card" HBox.hgrow="ALWAYS" spacing="10" style="-fx-padding: 20;">
                            <HBox alignment="CENTER_LEFT">
                                <Label text="OSTATNIE TRANSAKCJE" styleClass="card-title"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Button text="Zobacz wszystkie" onAction="#showFinanse" styleClass="icon-button" style="-fx-font-size: 10px;"/>
                            </HBox>
                            <ListView fx:id="recentTransactionsList" style="-fx-background-color: transparent;" VBox.vgrow="ALWAYS"/>
                        </VBox>

                        <VBox styleClass="card" HBox.hgrow="ALWAYS" spacing="10" style="-fx-padding: 20;">
                            <HBox alignment="CENTER_LEFT">
                                <Label text="NAJBLIÅ»SZE TERMINY" styleClass="card-title"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Button text="+ Nowe" onAction="#showZadania" styleClass="icon-button" style="-fx-font-size: 10px;"/>
                            </HBox>
                            <ListView fx:id="urgentTasksList" style="-fx-background-color: transparent;" VBox.vgrow="ALWAYS"/>
                        </VBox>
                    </HBox>
                </VBox>

                <BorderPane fx:id="viewFinanse" visible="false">
                    <center>
                        <VBox spacing="15" style="-fx-padding: 20;">
                            <HBox spacing="10" alignment="CENTER_LEFT" styleClass="card" style="-fx-padding: 15;">
                                <ComboBox fx:id="typeBox" promptText="Typ" prefWidth="100"/>
                                <TextField fx:id="categoryField" promptText="Kategoria"/>
                                <TextField fx:id="amountField" promptText="Kwota" prefWidth="80"/>
                                <TextField fx:id="descField" promptText="Opis" HBox.hgrow="ALWAYS"/>
                                <DatePicker fx:id="datePicker" promptText="Data" prefWidth="110" />
                                <Button text="DODAJ" onAction="#handleAddTransaction" styleClass="button-action" prefWidth="80"/>
                            </HBox>

                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <HBox spacing="5" alignment="CENTER_LEFT" HBox.hgrow="ALWAYS">
                                    <Button text="â—€" onAction="#prevMonth" styleClass="icon-button"/>
                                    <Label fx:id="monthLabel" text="STYCZEÅƒ 2026" styleClass="month-label"/>
                                    <Button text="â–¶" onAction="#nextMonth" styleClass="icon-button"/>
                                </HBox>
                                <TextField fx:id="searchField" promptText="ðŸ” Szukaj..." styleClass="search-field"/>
                            </HBox>

                            <TableView fx:id="transactionTable" VBox.vgrow="ALWAYS">
                                <columns>
                                    <TableColumn fx:id="colDate" text="DATA" prefWidth="100"/>
                                    <TableColumn fx:id="colCategory" text="KATEGORIA" prefWidth="150"/>
                                    <TableColumn fx:id="colDesc" text="OPIS" prefWidth="250"/>
                                    <TableColumn fx:id="colAmount" text="KWOTA" prefWidth="120"/>
                                    <TableColumn fx:id="colType" text="TYP" prefWidth="100"/>
                                </columns>
                                <columnResizePolicy><TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/></columnResizePolicy>
                            </TableView>
                        </VBox>
                    </center>

                    <right>
                        <VBox spacing="15" prefWidth="320" style="-fx-padding: 20 20 20 0;">
                            <VBox styleClass="card" alignment="TOP_CENTER" spacing="10" VBox.vgrow="ALWAYS">
                                <Label text="STRUKTURA WYDATKÃ“W" styleClass="card-title" style="-fx-padding: 10;"/>
                                <PieChart fx:id="expenseChart" labelsVisible="false" legendSide="BOTTOM" VBox.vgrow="ALWAYS" maxHeight="200"/>
                            </VBox>

                            <VBox styleClass="card" alignment="TOP_CENTER" spacing="10" VBox.vgrow="ALWAYS">
                                <Label text="REALIZACJA BUDÅ»ETU" styleClass="card-title" style="-fx-padding: 10;"/>
                                <ListView fx:id="budgetListView" VBox.vgrow="ALWAYS" style="-fx-background-color: transparent;"/>
                            </VBox>

                            <VBox styleClass="card" style="-fx-padding: 20; -fx-background-color: #2a3d4d; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.4), 10, 0, 0, 5);">
                                <Label text="BILANS MIESIÄ„CA" styleClass="card-subtitle" style="-fx-text-fill: #8b92a1; -fx-font-weight: bold;"/>
                                <HBox alignment="CENTER_LEFT" spacing="15">
                                    <Label fx:id="balanceLabel" text="0.00" style="-fx-text-fill: white; -fx-font-size: 24px; -fx-font-weight: bold;"/>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <VBox alignment="CENTER_RIGHT" spacing="2">
                                        <HBox spacing="5" alignment="CENTER_RIGHT">
                                            <Label text="â–²" style="-fx-text-fill: #51cf66; -fx-font-size: 10px;"/>
                                            <Label fx:id="incomeLabel" text="+0.00" style="-fx-text-fill: #51cf66; -fx-font-weight: bold; -fx-font-size: 12px;"/>
                                        </HBox>
                                        <HBox spacing="5" alignment="CENTER_RIGHT">
                                            <Label text="â–¼" style="-fx-text-fill: #ff6b6b; -fx-font-size: 10px;"/>
                                            <Label fx:id="expenseLabel" text="-0.00" style="-fx-text-fill: #ff6b6b; -fx-font-weight: bold; -fx-font-size: 12px;"/>
                                        </HBox>
                                    </VBox>
                                </HBox>
                            </VBox>
                        </VBox>
                    </right>
                </BorderPane>

                <VBox fx:id="viewZadania" visible="false" spacing="15" style="-fx-padding: 20;">
                    <HBox spacing="10" alignment="CENTER_LEFT" styleClass="card" style="-fx-padding: 15;">
                        <TextField fx:id="taskTitleField" promptText="Nowe zadanie..." HBox.hgrow="ALWAYS"/>
                        <ComboBox fx:id="priorityBox" promptText="Priorytet" prefWidth="110"/>
                        <DatePicker fx:id="taskDatePicker" promptText="Termin" prefWidth="120"/>
                        <Button text="DODAJ" onAction="#handleAddTask" styleClass="button-action"/>
                    </HBox>
                    <Label text="LISTA ZADAÅƒ" styleClass="section-title"/>
                    <ListView fx:id="taskListView" VBox.vgrow="ALWAYS" style="-fx-background-color: transparent;"/>
                </VBox>

                <VBox fx:id="viewCele" visible="false" spacing="15" style="-fx-padding: 20;">
                    <HBox spacing="10" alignment="CENTER_LEFT" styleClass="card" style="-fx-padding: 15;">
                        <TextField fx:id="goalNameField" promptText="Nazwa celu" HBox.hgrow="ALWAYS"/>
                        <TextField fx:id="goalTargetField" promptText="Cel (PLN)" prefWidth="100"/>
                        <TextField fx:id="goalCurrentField" promptText="Obecnie" prefWidth="100"/>
                        <DatePicker fx:id="goalDatePicker" promptText="Termin" prefWidth="120"/>
                        <Button text="DODAJ" onAction="#handleAddGoal" styleClass="button-action"/>
                    </HBox>
                    <Label text="CELE FINANSOWE" styleClass="section-title"/>
                    <ListView fx:id="goalListView" VBox.vgrow="ALWAYS" style="-fx-background-color: transparent;"/>
                </VBox>

                <VBox fx:id="viewRaporty" spacing="20" style="-fx-padding: 30;" visible="false" alignment="TOP_CENTER">
                    <HBox alignment="CENTER_LEFT" spacing="20">
                        <VBox>
                            <Label text="Zaawansowana Analityka" styleClass="header-title"/>
                            <Label text="PeÅ‚ny przekrÃ³j Twojej kondycji finansowej (Ostatnie 12 miesiÄ™cy)." style="-fx-text-fill: #8b92a1;"/>
                        </VBox>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Button fx:id="btnGenerateReport" text="Generuj Raport (HTML/PDF)" onAction="#handleGenerateReport" styleClass="button-action"/>
                    </HBox>

                    <ScrollPane fitToWidth="true" style="-fx-background-color: transparent; -fx-background: transparent;">
                        <content>
                            <VBox spacing="20" style="-fx-background-color: transparent;">
                                <HBox spacing="20" alignment="CENTER">
                                    <VBox styleClass="card" HBox.hgrow="ALWAYS" alignment="CENTER" style="-fx-padding: 15;">
                                        <Label text="ÅšREDNI PRZYCHÃ“D" style="-fx-text-fill: #8b92a1; -fx-font-size: 10px; font-weight: bold;"/>
                                        <Label fx:id="repAvgIncome" text="0 PLN" style="-fx-text-fill: #51cf66; -fx-font-size: 18px; -fx-font-weight: bold;"/>
                                    </VBox>
                                    <VBox styleClass="card" HBox.hgrow="ALWAYS" alignment="CENTER" style="-fx-padding: 15;">
                                        <Label text="ÅšREDNI WYDATEK" style="-fx-text-fill: #8b92a1; -fx-font-size: 10px; font-weight: bold;"/>
                                        <Label fx:id="repAvgExpense" text="0 PLN" style="-fx-text-fill: #ff6b6b; -fx-font-size: 18px; -fx-font-weight: bold;"/>
                                    </VBox>
                                    <VBox styleClass="card" HBox.hgrow="ALWAYS" alignment="CENTER" style="-fx-padding: 15;">
                                        <Label text="ROCZNE OSZCZÄ˜DNOÅšCI" style="-fx-text-fill: #8b92a1; -fx-font-size: 10px; font-weight: bold;"/>
                                        <Label fx:id="repTotalSavings" text="0 PLN" style="-fx-text-fill: #4fa3c7; -fx-font-size: 18px; -fx-font-weight: bold;"/>
                                    </VBox>
                                </HBox>

                                <VBox styleClass="card" style="-fx-padding: 20;">
                                    <Label text="PRZEPÅYWY PIENIÄ˜Å»NE (YOY)" styleClass="card-title"/>
                                    <AreaChart fx:id="reportTrendChart" createSymbols="false" legendSide="TOP" minHeight="300">
                                        <xAxis><CategoryAxis label="MiesiÄ…c"/></xAxis>
                                        <yAxis><NumberAxis label="Kwota (PLN)"/></yAxis>
                                    </AreaChart>
                                </VBox>

                                <HBox spacing="20">
                                    <VBox styleClass="card" HBox.hgrow="ALWAYS" style="-fx-padding: 20;">
                                        <Label text="STOPA OSZCZÄ˜DNOÅšCI (%)" styleClass="card-title"/>
                                        <BarChart fx:id="reportSavingsChart" legendVisible="false" minHeight="250">
                                            <xAxis><CategoryAxis label="MiesiÄ…c"/></xAxis>
                                            <yAxis><NumberAxis label="Procent (%)"/></yAxis>
                                        </BarChart>
                                    </VBox>

                                    <VBox styleClass="card" HBox.hgrow="ALWAYS" style="-fx-padding: 20;">
                                        <Label text="GÅÃ“WNE KATEGORIE KOSZTÃ“W" styleClass="card-title"/>
                                        <BarChart fx:id="reportCategoryChart" legendVisible="false" minHeight="250" horizontalGridLinesVisible="true">
                                            <xAxis><CategoryAxis label="Kategoria"/></xAxis>
                                            <yAxis><NumberAxis label="Suma WydatkÃ³w"/></yAxis>
                                        </BarChart>
                                    </VBox>
                                </HBox>

                            </VBox>
                        </content>
                    </ScrollPane>
                </VBox>

                <VBox fx:id="viewUstawienia" visible="false" spacing="20" style="-fx-padding: 30;">

                    <Label text="Konfiguracja Systemu" styleClass="header-title"/>
                    <Label text="ZarzÄ…dzaj swoim profilem i danymi." style="-fx-text-fill: #8b92a1; -fx-padding: 0 0 20 0;"/>

                    <HBox spacing="30" VBox.vgrow="ALWAYS">

                        <VBox spacing="20" HBox.hgrow="ALWAYS">
                            <VBox styleClass="card" style="-fx-padding: 20;">
                                <Label text="PROFIL UÅ»YTKOWNIKA" styleClass="settings-section-title"/>
                                <HBox alignment="CENTER_LEFT" spacing="15" style="-fx-padding: 15 0 0 0;">
                                    <StackPane>
                                        <Circle radius="25" fill="#323642"/>
                                        <Label text="JP" style="-fx-text-fill: white; -fx-font-weight: bold;"/>
                                    </StackPane>
                                    <VBox>
                                        <Label text="Jan PÅ‚atnik" style="-fx-text-fill: white; -fx-font-weight: bold;"/>
                                        <Label text="Administrator (Enterprise Lic.)" styleClass="settings-value"/>
                                    </VBox>
                                </HBox>
                            </VBox>

                            <VBox styleClass="card" style="-fx-padding: 20;" spacing="15">
                                <Label text="PREFERENCJE APLIKACJI" styleClass="settings-section-title"/>

                                <HBox alignment="CENTER_LEFT">
                                    <VBox>
                                        <Label text="GÅ‚Ã³wna Waluta" styleClass="settings-label"/>
                                        <Label text="UÅ¼ywana w raportach i kokpicie" styleClass="settings-value"/>
                                    </VBox>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <ComboBox promptText="PLN (Polski ZÅ‚oty)" style="-fx-pref-width: 150;"/>
                                </HBox>
                                <Separator style="-fx-opacity: 0.1;"/>
                                <HBox alignment="CENTER_LEFT">
                                    <VBox>
                                        <Label text="Powiadomienia" styleClass="settings-label"/>
                                        <Label text="Alerty o przekroczeniu budÅ¼etu" styleClass="settings-value"/>
                                    </VBox>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <CheckBox selected="true"/>
                                </HBox>
                            </VBox>
                        </VBox>

                        <VBox spacing="20" HBox.hgrow="ALWAYS">

                            <VBox styleClass="card" style="-fx-padding: 20;" spacing="15">
                                <Label text="ZARZÄ„DZANIE DANYMI" styleClass="settings-section-title"/>

                                <HBox alignment="CENTER_LEFT">
                                    <VBox>
                                        <Label text="Eksport Transakcji" styleClass="settings-label"/>
                                        <Label text="Format CSV (Excel)" styleClass="settings-value"/>
                                    </VBox>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Button text="Pobierz CSV" onAction="#handleExport" styleClass="icon-button"/>
                                </HBox>

                                <Separator style="-fx-opacity: 0.1;"/>

                                <HBox alignment="CENTER_LEFT">
                                    <VBox>
                                        <Label text="Kopia Zapasowa" styleClass="settings-label"/>
                                        <Label text="PeÅ‚ny zrzut bazy danych (.db)" styleClass="settings-value"/>
                                    </VBox>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Button text="UtwÃ³rz Backup" onAction="#handleBackup" styleClass="icon-button"/>
                                </HBox>
                            </VBox>

                            <VBox styleClass="card" style="-fx-padding: 20; -fx-border-color: #8a3c3c; -fx-border-width: 1;">
                                <HBox alignment="CENTER_LEFT" spacing="10">
                                    <Label text="âš " style="-fx-text-fill: #ff6b6b; -fx-font-size: 18px;"/>
                                    <Label text="STREFA NIEBEZPIECZNA" styleClass="settings-section-title" style="-fx-text-fill: #ff6b6b; -fx-border-color: transparent;"/>
                                </HBox>

                                <HBox alignment="CENTER_LEFT" style="-fx-padding: 10 0 0 0;">
                                    <VBox>
                                        <Label text="Reset Fabryczny" styleClass="settings-label"/>
                                        <Label text="Usuwa trwale wszystkie dane" styleClass="settings-value"/>
                                    </VBox>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Button text="RESETUJ SYSTEM" onAction="#handleClearDatabase" styleClass="button-action" style="-fx-background-color: #8a3c3c;"/>
                                </HBox>
                            </VBox>
                        </VBox>

                    </HBox>
                </VBox>

            </StackPane>
        </center>
    </BorderPane>

    <StackPane fx:id="commandPaletteOverlay" visible="false" style="-fx-background-color: rgba(0, 0, 0, 0.7);">
        <VBox maxWidth="600" maxHeight="400" spacing="10" styleClass="command-palette">
            <TextField fx:id="commandInput" promptText="Wpisz komendÄ™ (np. 'Nowe zadanie')..."
                       style="-fx-font-size: 16px; -fx-padding: 15; -fx-background-radius: 5 5 0 0;"/>
            <ListView fx:id="commandList" VBox.vgrow="ALWAYS" style="-fx-background-radius: 0 0 5 5; -fx-background-color: #262933;"/>
            <HBox spacing="10" style="-fx-padding: 5;">
                <Label text="â¬†â¬‡ Wybierz" style="-fx-text-fill: gray; -fx-font-size: 10px;"/>
                <Label text="ENTER Wykonaj" style="-fx-text-fill: gray; -fx-font-size: 10px;"/>
                <Label text="ESC Zamknij" style="-fx-text-fill: gray; -fx-font-size: 10px;"/>
            </HBox>
        </VBox>
    </StackPane>

</StackPane>