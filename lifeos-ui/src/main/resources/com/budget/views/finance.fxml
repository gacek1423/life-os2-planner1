<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.chart.*?>
<?import javafx.geometry.Insets?>

<StackPane xmlns="http://javafx.com/javafx/17"
           xmlns:fx="http://javafx.com/fxml/1"
           fx:controller="com.budget.controller.modules.FinanceController">

    <!-- WARSTWA 1: GÅ‚Ã³wna zawartoÅ›Ä‡ -->
    <BorderPane>
        <center>
            <TabPane styleClass="finance-tab-pane" tabClosingPolicy="UNAVAILABLE">

                <!-- ZAKÅADKA 1: DZIENNIK OPERACJI -->
                <Tab text="DZIENNIK OPERACJI">
                    <HBox>
                        <!-- Lewa strona - gÅ‚Ã³wne operacje -->
                        <VBox spacing="20" style="-fx-padding: 30;" HBox.hgrow="ALWAYS">
                            <!-- Toolbar -->
                            <HBox spacing="15" alignment="CENTER_LEFT">
                                <Label text="FINANSE" styleClass="header-title"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Button text="âŒ˜K Command Palette" onAction="#showCommandPalette"
                                        styleClass="icon-button" style="-fx-font-size: 11px;"/>
                            </HBox>

                            <!-- Formularz dodawania -->
                            <HBox spacing="15" alignment="CENTER_LEFT" styleClass="card" style="-fx-padding: 20;">
                                <ComboBox fx:id="typeBox" promptText="Typ" prefWidth="110"/>
                                <ComboBox fx:id="categoryBox" promptText="Kategoria" editable="true" prefWidth="160"/>
                                <TextField fx:id="amountField" promptText="Kwota" prefWidth="100"/>
                                <TextField fx:id="descField" promptText="Opis" HBox.hgrow="ALWAYS"/>
                                <DatePicker fx:id="datePicker" promptText="Data" prefWidth="130"/>
                                <Button text="DODAJ" onAction="#addTransaction" styleClass="button-action" prefWidth="90"/>
                            </HBox>

                            <!-- Nawigacja miesiÄ…ca -->
                            <HBox spacing="15" alignment="CENTER_LEFT">
                                <HBox spacing="5" alignment="CENTER_LEFT" HBox.hgrow="ALWAYS">
                                    <Button text="â—€" onAction="#prevMonth" styleClass="icon-button"/>
                                    <Label fx:id="monthLabel" text="STYCZEÅƒ 2026" styleClass="card-value" style="-fx-font-size: 18px;"/>
                                    <Button text="â–¶" onAction="#nextMonth" styleClass="icon-button"/>
                                </HBox>
                            </HBox>

                            <!-- Tabela transakcji -->
                            <TableView fx:id="transactionTable" VBox.vgrow="ALWAYS">
                                <columns>
                                    <TableColumn fx:id="colDate" text="DATA" prefWidth="100"/>
                                    <TableColumn fx:id="colCategory" text="KATEGORIA" prefWidth="150"/>
                                    <TableColumn fx:id="colDesc" text="OPIS" prefWidth="250"/>
                                    <TableColumn fx:id="colAmount" text="KWOTA" prefWidth="120"/>
                                    <TableColumn fx:id="colType" text="TYP" prefWidth="100"/>
                                </columns>
                                <columnResizePolicy><TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/></columnResizePolicy>
                                <placeholder><Label text="Brak danych w tym miesiÄ…cu" style="-fx-text-fill: #6c7280;"/></placeholder>
                            </TableView>
                        </VBox>

                        <!-- Prawa strona - wykresy i podsumowanie -->
                        <VBox spacing="20" prefWidth="320" style="-fx-padding: 30 30 30 0;">
                            <!-- Wykres koÅ‚owy -->
                            <VBox styleClass="card" alignment="TOP_CENTER" spacing="10" VBox.vgrow="ALWAYS">
                                <Label text="STRUKTURA WYDATKÃ“W" styleClass="card-title" style="-fx-padding: 15;"/>
                                <PieChart fx:id="expenseChart" labelsVisible="false" legendSide="RIGHT" VBox.vgrow="ALWAYS" maxHeight="250"/>
                            </VBox>

                            <!-- Bilans miesiÄ…ca -->
                            <VBox styleClass="card" style="-fx-padding: 25; -fx-background-color: linear-gradient(to bottom right, #2a3d4d, #1f2229);">
                                <Label text="BILANS MIESIÄ„CA" styleClass="card-subtitle"/>
                                <HBox alignment="CENTER_LEFT" spacing="10">
                                    <Label fx:id="balanceLabel" text="0.00" styleClass="card-value-big"/>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <VBox alignment="CENTER_RIGHT" spacing="2">
                                        <Label fx:id="incomeLabel" text="+0.00" style="-fx-text-fill: #51cf66; -fx-font-weight: bold;"/>
                                        <Label fx:id="expenseLabel" text="-0.00" style="-fx-text-fill: #ff6b6b; -fx-font-weight: bold;"/>
                                    </VBox>
                                </HBox>
                            </VBox>
                        </VBox>
                    </HBox>
                </Tab>

                <!-- ZAKÅADKA 2: PLANOWANIE BUDÅ»ETU -->
                <Tab text="PLANOWANIE BUDÅ»ETU">
                    <VBox spacing="20" style="-fx-padding: 40;">
                        <!-- Header -->
                        <HBox alignment="CENTER_LEFT" spacing="20">
                            <VBox>
                                <Label text="Kontrola BudÅ¼etowa" styleClass="header-title"/>
                                <Label text="Ustal limity wydatkÃ³w, aby nie przepaliÄ‡ portfela." style="-fx-text-fill: #8b92a1;"/>
                            </VBox>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button text="ðŸ”„ OdÅ›wieÅ¼ AnalizÄ™" onAction="#refreshBudgets" styleClass="icon-button"/>
                        </HBox>

                        <!-- Lista budÅ¼etÃ³w -->
                        <ScrollPane fitToWidth="true" style="-fx-background-color: transparent; -fx-background: transparent;" VBox.vgrow="ALWAYS">
                            <content>
                                <VBox fx:id="budgetListContainer" spacing="15" style="-fx-padding: 0 10 0 0;">
                                </VBox>
                            </content>
                        </ScrollPane>

                        <!-- Formularz dodawania budÅ¼etu -->
                        <VBox styleClass="card" style="-fx-padding: 20; -fx-border-color: rgba(79, 163, 199, 0.3);">
                            <Label text="DODAJ NOWY LIMIT" styleClass="card-subtitle" style="-fx-padding: 0 0 10 0;"/>
                            <HBox spacing="15" alignment="CENTER_LEFT">
                                <ComboBox fx:id="newBudgetCategory" promptText="Wybierz kategoriÄ™" editable="true" prefWidth="200"/>
                                <TextField fx:id="newBudgetLimit" promptText="Limit (np. 1500)" prefWidth="150"/>
                                <Button text="ZATWIERDÅ¹" onAction="#handleAddNewBudget" styleClass="button-action"/>
                                <Label text="* System automatycznie zasugeruje kwotÄ™ na podstawie historii." style="-fx-text-fill: #6c7280; -fx-font-size: 11px; -fx-font-style: italic;"/>
                            </HBox>
                        </VBox>
                    </VBox>
                </Tab>

            </TabPane>
        </center>
    </BorderPane>

    <!-- WARSTWA 2: Command Palette (nakÅ‚adka) -->
    <StackPane fx:id="commandPane" visible="false" mouseTransparent="true"
               style="-fx-background-color: rgba(0,0,0,0.7);"
               onMouseClicked="#handleOverlayClick">
        <VBox prefWidth="650" maxHeight="500" styleClass="command-palette, card"
              style="-fx-background-color: #262933; -fx-border-color: #4fa3c7; -fx-border-width: 1; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.6), 50, 0, 0, 10);">

            <!-- Header z polem wyszukiwania -->
            <HBox spacing="10" style="-fx-padding: 15; -fx-border-color: #323642; -fx-border-width: 0 0 1 0;">
                <Label text="âŒ˜" style="-fx-font-size: 20px; -fx-text-fill: #4fa3c7;"/>
                <TextField fx:id="commandField" promptText="Wpisz komendÄ™ (np: 'dodaj wydatek 50 jedzenie')"
                           HBox.hgrow="ALWAYS" style="-fx-background-color: transparent; -fx-border-color: transparent; -fx-font-size: 16px;"/>
                <Label text="ESC" style="-fx-text-fill: #6c7280; -fx-font-size: 11px; -fx-background-color: #323642; -fx-padding: 2 6; -fx-background-radius: 3;"/>
            </HBox>

            <!-- Lista sugestii -->
            <ListView fx:id="commandResult" styleClass="command-result-list"
                      style="-fx-background-color: transparent; -fx-padding: 0;"/>

            <!-- Footer z podpowiedziami -->
            <HBox spacing="15" style="-fx-padding: 10 15; -fx-border-color: #323642; -fx-border-width: 1 0 0 0;">
                <Label text="â†‘â†“ Wybierz" style="-fx-text-fill: #6c7280; -fx-font-size: 10px;"/>
                <Label text="â†µ Wykonaj" style="-fx-text-fill: #6c7280; -fx-font-size: 10px;"/>
                <Region HBox.hgrow="ALWAYS"/>
                <Label text="Command Palette v1.0" style="-fx-text-fill: #6c7280; -fx-font-size: 10px;"/>
            </HBox>
        </VBox>
    </StackPane>
</StackPane>